<?xml version="1.0" encoding="utf-8" ?>
<!--
Copyright (c) 2025 Proton AG

This file is part of ProtonVPN.

ProtonVPN is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

ProtonVPN is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with ProtonVPN.  If not, see <https://www.gnu.org/licenses/>.
-->

<UserControl x:Class="ProtonVPN.Client.UI.Main.Profiles.Components.ProfileOptionsSelectorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ap="using:ProtonVPN.Client.Common.UI.AttachedProperties"
             xmlns:controls="using:CommunityToolkit.WinUI.Controls"
             xmlns:custom="using:ProtonVPN.Client.Common.UI.Controls.Custom"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:pathicons="using:ProtonVPN.Client.Common.UI.Assets.Icons.PathIcons"
             xmlns:models="using:ProtonVPN.Client.Core.Models"
             x:DefaultBindMode="OneWay"
             mc:Ignorable="d">

    <UserControl.Resources>
        <Style x:Key="DropDownGhostButtonStyle" BasedOn="{StaticResource SecondaryGhostButtonStyle}" TargetType="custom:GhostButton">
            <Setter Property="Background" Value="{ThemeResource InteractionDefaultColorBrush}" />
            <Setter Property="Padding" Value="4,2" />
        </Style>

        <DataTemplate x:Key="ExternalAppItemTemplate"
                      x:DataType="models:ExternalApp">
            <StackPanel Orientation="Horizontal"
                        Spacing="8">
                <Image Width="20"
                       VerticalAlignment="Center"
                       Source="{x:Bind AppIcon}" />
                <TextBlock VerticalAlignment="Center"
                           Text="{x:Bind AppName}" />
            </StackPanel>
        </DataTemplate>
    </UserControl.Resources>

    <controls:SettingsExpander HorizontalAlignment="Stretch"
                               ap:CustomTags.IsTagged="True"
                               ap:CustomTags.Tag="{x:Bind ViewModel.Localizer.Get('Common_Tags_New')}"
                               Description="{x:Bind ViewModel.Localizer.Get('Profile_Options_Description')}"
                               Expanded="OnConnectAndGoExpanded"
                               Header="{x:Bind ViewModel.Localizer.Get('Profile_Options_Header')}"
                               IsExpanded="{x:Bind ViewModel.SelectedConnectAndGoMode.IsEnabled}"
                               Style="{StaticResource ProfileSettingsExpanderStyle}">

        <custom:GhostButton AutomationProperties.AutomationId="ConnectAndGoDropDown"
                            Content="{x:Bind ViewModel.SelectedConnectAndGoMode.Header}"
                            Style="{StaticResource DropDownGhostButtonStyle}">
            <custom:GhostButton.RightIcon>
                <pathicons:ChevronTinyDown Size="Pixels16" />
            </custom:GhostButton.RightIcon>
            <custom:GhostButton.Flyout>
                <MenuFlyout Placement="BottomEdgeAlignedRight"
                            ShouldConstrainToRootBounds="True">
                    <custom:ActivatableMenuFlyoutItem AutomationProperties.AutomationId="ConnectAndGoOffMenuItem"
                                                      Command="{x:Bind ViewModel.DisableConnectAndGoCommand, Mode=OneTime}"
                                                      IsActive="{x:Bind ViewModel.SelectedConnectAndGoMode.IsEnabled, Converter={StaticResource NotBooleanToBooleanConverter}}"
                                                      Text="{x:Bind ViewModel.Localizer.Get('Common_States_Off')}" />
                    <custom:ActivatableMenuFlyoutItem AutomationProperties.AutomationId="ConnectAndGoWebsiteMenuItem"
                                                      Command="{x:Bind ViewModel.EnableConnectAndGoToWebsiteCommand, Mode=OneTime}"
                                                      IsActive="{x:Bind ViewModel.SelectedConnectAndGoMode.IsConnectAndGoToWebsiteEnabled}"
                                                      Text="{x:Bind ViewModel.Localizer.Get('Profile_Options_ConnectAndGo_Website')}" />
                    <custom:ActivatableMenuFlyoutItem AutomationProperties.AutomationId="ConnectAndGoApplicationMenuItem"
                                                      Command="{x:Bind ViewModel.EnableConnectAndGoToApplicationCommand, Mode=OneTime}"
                                                      IsActive="{x:Bind ViewModel.SelectedConnectAndGoMode.IsConnectAndGoToApplicationEnabled}"
                                                      Text="{x:Bind ViewModel.Localizer.Get('Profile_Options_ConnectAndGo_Application')}" />
                </MenuFlyout>
            </custom:GhostButton.Flyout>
        </custom:GhostButton>

        <controls:SettingsExpander.Items>
            <controls:SettingsCard Style="{StaticResource VerticalSettingsCardStyle}"
                                   Padding="0"
                                   Margin="0"
                                   Background="Transparent">
                <StackPanel>
                    <Grid RowSpacing="12"
                          HorizontalAlignment="Stretch"
                          Visibility="{x:Bind ViewModel.SelectedConnectAndGoMode.IsConnectAndGoToWebsiteEnabled, Converter={StaticResource BooleanToVisibilityConverter}}">

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"
                                              MinWidth="80" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Row="0"
                                   Grid.Column="0"
                                   Margin="0,10,16,0"
                                   VerticalAlignment="Top"
                                   Text="{x:Bind ViewModel.Localizer.Get('Profile_Options_Url')}" />

                        <TextBox Grid.Row="0"
                                 Grid.Column="1"
                                 ap:FieldValidation.ErrorMessage="{x:Bind ViewModel.ConnectAndGoUrlErrorMessage}"
                                 ap:FieldValidation.HasErrors="{x:Bind ViewModel.IsConnectAndGoUrlValid, Converter={StaticResource NotBooleanToBooleanConverter}}"
                                 Style="{StaticResource ValidationTextBoxStyle}"
                                 Text="{x:Bind ViewModel.ConnectAndGoUrl, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                        <CheckBox Grid.Row="1"
                                  Grid.Column="1"
                                  VerticalAlignment="Center"
                                  Content="{x:Bind ViewModel.Localizer.Get('Profile_Options_ConnectAndGo_PrivateBrowsingMode')}"
                                  IsChecked="{x:Bind ViewModel.UsePrivateBrowsingMode, Mode=TwoWay}" />
                    </Grid>

                    <Grid RowSpacing="8"
                          Visibility="{x:Bind ViewModel.SelectedConnectAndGoMode.IsConnectAndGoToApplicationEnabled, Converter={StaticResource BooleanToVisibilityConverter}}">

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"
                                              MinWidth="80" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0"
                                   Margin="0,0,16,0"
                                   VerticalAlignment="Center"
                                   Text="{x:Bind ViewModel.Localizer.Get('Profile_Options_Application')}" />

                        <custom:GhostButton Grid.Column="1"
                                            Height="36"
                                            Command="{x:Bind ViewModel.SelectAppCommand, Mode=OneTime}"
                                            Content="{x:Bind ViewModel.ConnectAndGoAppName}"
                                            Style="{StaticResource DropDownGhostButtonStyle}">
                            <custom:GhostButton.LeftIcon>
                                <ImageIcon Width="20"
                                           Source="{x:Bind ViewModel.ConnectAndGoApp.AppIcon}"
                                           Visibility="{x:Bind ViewModel.ConnectAndGoApp, Converter={StaticResource NotNullToVisibilityConverter}}" />
                            </custom:GhostButton.LeftIcon>
                            <custom:GhostButton.RightIcon>
                                <pathicons:ChevronRight Size="Pixels16" />
                            </custom:GhostButton.RightIcon>

                        </custom:GhostButton>

                    </Grid>

                </StackPanel>
            </controls:SettingsCard>

        </controls:SettingsExpander.Items>
    </controls:SettingsExpander>

</UserControl>